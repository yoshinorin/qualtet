openapi: 3.1.0
info:
  title: Qualtet API
  description: |
    # Description
    This API documentation regarding OpenAPI specification. Generated by [ReDoc](https://github.com/Rebilly/ReDoc).
  version: v2.9.1
externalDocs:
  description: Source code
  url: 'https://github.com/yoshinorin/qualtet'
servers:
  - url: http://example.com/
paths:
  /status:
    get:
      summary: Get API server status
      description:
        This API will be removed in version `2.10`.
      tags:
        - status
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: operational
  /system/health:
    get:
      summary: Get API server health
      tags:
        - system
      responses:
        200:
          description: API server is runnning
  /system/metadata:
    get:
      summary: Get system metadata
      tags:
        - system
      responses:
        200:
          description: Response when Success (If envval `QUALTET_HTTP_ENDPOINT_SYSTEM_METADATA_ENABLED` is `true`)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/applicationInfo'
        404:
          description: Response when Success (If envval `QUALTET_HTTP_ENDPOINT_SYSTEM_METADATA_ENABLED` is `false` or not exists)
  /token:
    post:
      summary: Create an IDToken
      tags:
        - token
      description: |
        Create an IDToken
      security:
        - basicAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/requestToken'
      responses:
        201:
          description: Create an IDToken succeeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/idToken'
        400:
          description: Payload is wrong
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/errorMessage'
        401:
          description: Unauthorized
  /archives:
    get:
      summary: Get all articles
      tags:
        - archives
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/simpleArticle'
  /articles:
    get:
      summary: Get articles with count
      tags:
        - articles
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    description: The number of all articles.
                    type: integer
                    example: 99
                  articles:
                    type: array
                    items:
                      $ref: '#/components/schemas/article'
      parameters:
        - in: query
          name: page
          schema:
            type: integer
          description: The number of pages for pagination.
        - in: query
          name: limit
          schema:
            type: integer
          description: The number of items to return. Max is 10.
  /authors:
    get:
      summary: Get all authors
      tags:
        - authors
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/author'
  /authors/{authorName}:
    get:
      summary: Get an author
      tags:
        - authors
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: object
                $ref: '#/components/schemas/author'
        404:
          description: Author not found
          # content: TODO
  /contents:
    post:
      summary: Create or Update a content
      tags:
        - contents
      description: |
        Create or Update a content
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/requestContent'
      responses:
        201:
          description: Create or Update succeeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/responseContent'
        400:
          description: BadRequest
        401:
          description: Unauthorized
        422:
          description: |
            - Author is not found
            - Content type is not found
            - Series is not found
  /contents/{contentPath}:
    get:
      summary: Get a content
      tags:
        - contents
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/responseContent'
        404:
          description: Content not found
          # content: TODO
  /contents/{contentId}:
    delete:
      summary: Delete a content
      tags:
        - contents
      security:
        - bearerAuth: []
      responses:
        204:
          description: Delete succeeded
        401:
          description: Unauthorized
        404:
          description: Content not found
  /tags:
    get:
      summary: Get a tags
      tags:
        - tags
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/tagWithCount'
  /tags/{tagName}:
    get:
      summary: Get an articles by tagName
      tags:
        - tags
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/simpleArticle'
        404:
          description: Content not found
          # content: TODO
  /tags/{tagId}:
    delete:
      summary: Delete a tag
      tags:
        - tags
      security:
        - bearerAuth: []
      responses:
        204:
          description: Delete succeeded
        401:
          description: Unauthorized
        404:
          description: Tag not found
  /content-types/{contentPath}:
    get:
      summary: Get content-types
      tags:
        - content-types
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/contentType'
  /content-types/{contentTypeName}:
    get:
      summary: Get a content-type with name
      tags:
        - content-types
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/contentType'
  /sitemaps:
    get:
      summary: Get an articles url & updated date for sitemaps.xml
      tags:
        - sitemaps
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/sitemaps'
  /feed/{feedName}:
    get:
      summary: Get a feeds
      tags:
        - feed
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/feed'
  /caches/:
    delete:
      summary: Invalidate all caches
      tags:
        - cache
      security:
        - bearerAuth: []
      responses:
        204:
          description: Caches are invalidated
        401:
          description: Unauthorized
  /search:
    get:
      summary: Search contents
      tags:
        - search
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    description: The number of hits contents.
                    type: integer
                    example: 99
                  contents:
                    type: array
                    items:
                      $ref: '#/components/schemas/responseSearch'
        422:
          description: Unprocessable request
      parameters:
        - in: query
          name: q
          schema:
            type: string
          description: Word for seach contents.
  /series:
    get:
      summary: Get all series
      tags:
        - series
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/series'
    post:
      summary: Create or Update a series
      tags:
        - series
      description: |
        Create or Update a series
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/requestSeries'
      responses:
        201:
          description: Create or Update succeeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/series'
        400:
          description: BadRequest
        401:
          description: Unauthorized
  /series/{seriesName}:
    get:
      summary: Get a series
      tags:
        - series
      responses:
        200:
          description: Response when Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/series'
        404:
          description: Series not found
components:
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    requestToken:
      type: object
      properties:
        authorId:
          type: string
          example: "01dfvhk1bz8lk1e4b1s2hdw9ku"
        password:
          type: string
          example: "examplepassword"
      required:
        - authorId
        - password
    idToken:
      type: object
      properties:
        token:
          type: string
          example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpc3Mi...."
    applicationInfo:
      type: object
      properties:
        name:
          type: string
          example: "qualtet"
        version:
          type: string
          example: "v2.9.1"
        repository:
          type: string
          example: "https://github.com/yoshinorin/qualtet"
        runtime:
          type: object
          properties:
            runtime:
              type: string
              example: "Java"
            vendor:
              type: string
              example: "Eclipse Adoptium"
            version:
              type: string
              example: "17.0.5"
        build:
          type: object
          properties:
            commit:
              type: string
              example: "237856f"
            url:
              type: string
              example: "https://github.com/yoshinorin/qualtet/commit/237856f"
            scalaVersion:
              type: string
              example: "3.3.0"
            sbtVersion:
              type: string
              example: "1.9.3"
    author:
      type: object
      properties:
        id:
          type: string
          format: ulid
          example: "01fgvhk1bz6546e4b1s2hdw0pw"
        name:
          type: string
          example: JohnDoe
        displayName:
          type: string
          example: John
        createdAt:
          type: long
          description: Unix time
          example: 1625065318
    contentType:
      type: object
      properties:
        id:
          type: string
          format: ulid
          example: "01fgvhjxftxfjvxg3xbvv78kr1"
        name:
          type: string
          example: "article"
    externalResource:
      type: object
      properties:
        kind:
          type: string
          example: "js"
        values:
          type: array
          example: "['mathjax','marmaid']"
    tag:
      type: object
      properties:
        id:
          type: string
          format: ulid
          example: "01frdbdb6s2mxshxzk3wan0f6d"
        name:
          type: string
          example: "diary"
    tagWithCount:
      type: object
      properties:
        id:
          type: string
          format: ulid
          example: "01frdbdb6s2mxshxzk3wan0f6d"
        name:
          type: string
          example: "diary"
        count:
          description: number of related articles
          type: number
          example: 28
    simpleArticle:
      type: object
      properties:
        path:
          type: string
          format: url(excludes domain part)
          example: "/post/test-article"
        title:
          type: string
          example: "Post Title"
        publishedAt:
          type: long
          description: Unix time
          example: 1625065318
    article:
      type: object
      properties:
        id:
          type: string
          format: ulid
          example: "01fgvhme5b7cj0m5agr9f4g2ca"
        title:
          type: string
          example: "Post Title"
        path:
          type: string
          format: url(excludes domain part)
          example: "/post/test-article"
        content:
          type: string
          example: "Post Content.... RAW strings"
        publishedAt:
          type: long
          description: Unix time
          example: 1625065509
        updatedAt:
          type: long
          description: Unix time
          example: 1625065592
    feed:
      type: object
      properties:
        title:
          type: string
          example: "Post Title"
        link:
          type: string
          format: url(excludes domain part)
          example: "/post/test-article"
        id:
          type: string
          format: url(excludes domain part)
          example: "/post/test-article"
        published:
          type: long
          description: Unix time
          example: 1625065509
        updated:
          type: long
          description: Unix time
          example: 1625065592
    series:
      type: object
      properties:
        id:
          type: string
          example: "01gs85hv65rhsq06fdp7j3ers0"
        name:
          type: string
          example: "qualtet-development-history"
        title:
          type: string
          example: "Example series"
        description:
          type: string
          example: "Example series description"
        articles:
          type: array
          items:
            $ref: '#/components/schemas/article'
    requestSeries:
      type: object
      properties:
        path:
          type: string
          format: url(excludes domain part)
          example: "/series/<example>"
        title:
          type: string
          example: "Example series"
        description:
          type: string
          example: "Example series description"
      required:
        - path
        - title
    requestContent:
      type: object
      properties:
        contentType:
          type: string
          example: "article"
        path:
          type: string
          example: "/2020/01/01/new-year"
        externalResources:
          type: array
          items:
            $ref: '#/components/schemas/externalResource'
        title:
          type: string
          example: "Post Title"
        rawContent:
          type: string
          example: "Post Content.... RAW strings"
        htmlContent:
          type: string
          example: "Post Content.... HTML strings"
        tags:
          type: array
          example: "['diary', 'tech']"
        series:
          type: string
          example: "qualtet-development-history"
        publishedAt:
          type: long
          description: Unix time
          example: 1625065509
        updatedAt:
          type: long
          description: Unix time
          example: 1625065509
      required:
        - contentType
        - path
        - title
        - rawContent
        - htmlContent
    responseContent:
      type: object
      properties:
        id:
          type: string
          format: ulid
          example: "01fgvhme5b7cj0m5agr9f4g2ca"
        authorId:
          type: string
          format: ulid
          example: "01fgvhk1bz6546e4b1s2hdw0pw"
        contentTypeId:
          type: string
          format: ulid
          example: "01fgvhjxftxfjvxg3xbvv78kr1"
        title:
          type: string
          example: "Post Title"
        robotsAttributes:
          type: string
          example: "noarchive, noimageindex"
        externalResources:
          type: array
          items:
            $ref: '#/components/schemas/externalResource'
        tags:
          type: array
          items:
            $ref: '#/components/schemas/tag'
        description:
          type: string
          example: "Post description... not HTML strings"
        content:
          type: string
          example: "Post Content.... HTML strings"
        length:
          type: integer
          example: 1252
        authorName:
          type: string
          description: "This field return from `authors.display_name` coloumn value."
          example: "Jhon Due"
        publishedAt:
          type: long
          description: Unix time
          example: 1625065509
        updatedAt:
          type: long
          description: Unix time
          example: 1627095819
    sitemaps:
      type: object
      properties:
        loc:
          type: string
          example: "https://example.com/aaa/bbb/ccc"
        lastMod:
          type: string
          example: "YYYY-MM-DD"
    responseSearch:
      type: object
      properties:
        title:
          type: string
          example: "Post Title"
        path:
          type: string
          format: url(excludes domain part)
          example: "/post/test-article"
        content:
          type: string
          example: "Content.... without specific characters (e.g: HTML) strings"
        publishedAt:
          type: long
          description: Unix time
          example: 1625065509
        updatedAt:
          type: long
          description: Unix time
          example: 1627095819
    errorMessage:
      type: object
      properties:
        message:
          type: string
          example: Something is wrong
